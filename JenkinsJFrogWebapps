pipeline{ 
	agent { 
	    label 'angular' 
	}
	stages {
		stage('Checkout-stage') {
			steps {
				git branch: 'main', credentialsId: 'github', url: 'https://github.com/Jayachandran-S7/java-example.git'
				echo 'repo cloning'
			}
		}

		stage('Test-stage') {
			steps {
				echo 'This is a testcase and taken care while building an aritfact itself'
			}
		}

		stage('Build-stage') {
			steps {
				sh 'mvn clean package'
				echo 'package distribution done'
			}
		}

		stage('Deploy-stage') {
			steps {
				sh 'sudo cp target/*.war /opt/tomcat/apache-tomcat-9.0.68/webapps'	
				echo 'copied java war file into tomcat webapps folder to configure web element integration'
			}
		}
	
		stage ('push-to-artifactory') {
				steps {
					dir('/home/ubuntu/jenkins/workspace/demo-pipeline/target/works-with-heroku-1.0.war')
					rtServer (
						id: 'server-1',
						url: 'http://3.108.41.148:8081/artifactory',
						credentialsId: 'jfrog-connection', 
						timeout: 300
					)
					rtUpload (
						serverId: 'server-1',
						spec: '''{
							"files": [
								{
									"pattern": "home/ubuntu/jenkins/workspace/demo-pipeline/target/works-with-heroku-1.0.war",
									"target": "Maven/test1"
								}
							]
						}''',
					)
				}
		}
	}
}
